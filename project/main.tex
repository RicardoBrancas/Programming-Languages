\documentclass{beamer}
\usepackage{color}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{listings}

\usetikzlibrary{arrows,positioning,decorations.pathreplacing}

\usetheme{fibeamer}

\newcommand{\hl}{\textcolor{fibeamer@darkBlue} }
%\newcommand{\mcolorbox}[1, 2]{\colorbox{#1}{$\displaystyle #2$}}
\newcommand{\highlight}[1]{\colorbox{yellow}{\ensuremath{#1}}}

%% ===   DEFINITIONS   ===

\theoremstyle{definition} % See Lesson Three of the LaTeX Manual for more on this kind of "proclamation."
\newtheorem*{dfn}{A Reasonable Definition}

\tikzstyle{tex1} = [minimum width=3cm, minimum height=1cm, text centered]
\tikzstyle{tsml} = [minimum width=3cm, text centered, font=\footnotesize]
\tikzstyle{box1} = [rectangle, rounded corners, minimum width=3cm, minimum height=1cm, text centered, draw=fibeamer@blue, fill=fibeamer@lightBlue]

%% === END DEFINITIONS ===

\title{Program Synthesis}
\subtitle{An overview of logic-based approaches}
\author{Ricardo Brancas}
\institute{Instituto Superior TÃ©cnico}

\AtBeginSection[]{
\begin{frame}
    \frametitle{Presentation Outline}
    \tableofcontents[currentsection]
\end{frame}
}

\begin{document}

\begin{frame}
    \titlepage
\end{frame}

\section{What is it?}

\begin{frame}
    \frametitle{Program Synthesis}

    \centering
    \begin{tikzpicture}[node distance=2cm]

        \node[box1] (spec)                     {Specification};
      \onslide<2->{
        \node[box1] (synth) [below of = spec]  {Synthesiser};
      }
        \node[box1] (prog)  [below of = synth] {Program};

      \onslide<3->{
        \node[tsml] (spec1) [right = .75cm of spec, align=left] {Input/Output Examples\\
                                                                 First-order Logic Specification\\
                                                                 Hoare Logic Specification\\
                                                                 ...};
        \draw[decorate,decoration={brace, raise=7pt, amplitude=5pt}] (spec1.south west) -- (spec1.north west);
        %TODO add more examples of specifications
      }

      \onslide<2->{
        \draw[->] (spec)  -- (synth);
        \draw[->] (synth) -- (prog);
      }

    \end{tikzpicture}


\end{frame}

\begin{frame}
    \frametitle{Proof of Correctness}

    How can we check if a program is correct (according to the specification)?\\~\\
    \pause
    We can use a logic formulation.

    %TODO too empty
\end{frame}

\section{Logic Background}


\begin{frame}
    \frametitle{First Order Logic}

    %TODO define FOL

    \begin{example}
        $\forall x.P(x)$\\
        %\hspace*{20pt} for all $x$, $P(x)$ must hold\\
        $\exists y \forall x.Q(y, x)$\\
        %\hspace*{20pt} there is some $y$, such that for all $x$, $Q(y, x)$ holds
    \end{example}

    \pause
    First order logic is undecidable (in general, it is impossible to check if a given formula is correct).
    How can we solve this?
\end{frame}

\begin{frame}
    \frametitle{Satisfiability Modulo Theories}

    \begin{block}{Satisfiability Modulo Theory (SMT)}
        A decision problem on decidable subsets of first order logic.\\
        Such subsets are called theories.
    \end{block}

    \begin{block}{$T$-satisfiability}
        Given a theory \hl{$T$}, we say that a formula \hl{$\Phi$} is \hl{$T$}-satisfiable iff there is some model \hl{$M$} of \hl{$T$}, such that \hl{$\Phi$} holds in \hl{$M$}.
    \end{block}~\\

    A model can be seen as a mapping from variables to constants/functions.

    %TODO what is a model?
\end{frame}

\begin{frame}
    \frametitle{Theories}

    \begin{block}{Theory}
        A subset of first-order logic that is decidable. Theories can be combined to create more expressive something. %TODO
    \end{block}

    \begin{exampleblock}{Example: Equality with Uninterpreted Functions}
        $(f(b) = d) \wedge (f(a) + f(b) = d) \wedge (a = d)$
    \end{exampleblock}

    \begin{exampleblock}{Example: Linear Arithmetic}
        $3x + 2y < 3$\\
        $x + y + z = 45$
    \end{exampleblock}
\end{frame}

\begin{frame}
    \frametitle{Other Useful Theories for PL}

    \begin{itemize}
        \item Bit vectors
        \item Arrays
        \item Pointer logic
        \item Quantified Theories
    \end{itemize}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Proof of Correctness (II)}

    How can we check if a program is correct (according to the specification)?\\
    We can use a logic formulation.\\

    \begin{columns}[T] % align columns
        \begin{column}{.48\textwidth}
            \begin{exampleblock}{Simple Hoare Triple}
                \vspace*{-\baselineskip}\setlength\belowdisplayshortskip{0pt}
                \begin{lstlisting}[xleftmargin=1em, escapechar=!]
!\colorbox{fibeamer@lightBlue}{\{ X = 3 \}}!
Y := X - 2
X := X - 1
!\colorbox{fibeamer@lightOrange}{\{ X = 2 $\wedge$ Y = 1\}}!

                \end{lstlisting}
            \end{exampleblock}
        \end{column}%
        \begin{column}{.48\textwidth}
            \begin{exampleblock}{SMT Formula}
                \vspace*{-1.5\baselineskip}\setlength\belowdisplayshortskip{0pt}
                \begin{align*}\footnotesize& \tikz[baseline]{\node[fill=fibeamer@lightBlue,anchor=base] (t2) {$X_0 = 3$};} \\
                    \wedge \enspace & Y_0 = (X_0 - 2) \\
                    \wedge \enspace & X_1 = (X_0 - 1) \\
                    \wedge \enspace & \tikz[baseline]{\node[fill=fibeamer@lightOrange,anchor=base] (t2) {$X_1 = 2 \wedge Y_0 = 1$};}
                \end{align*}

            \end{exampleblock}
        \end{column}%
    \end{columns}~\\
    \pause
    We say that a program is correct, if the corresponding SMT formula is satisfiable.
\end{frame}

\end{document}
